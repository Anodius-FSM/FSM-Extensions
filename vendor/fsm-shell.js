/**
 * Minified by jsDelivr using Terser v5.7.1.
 * Original file: /npm/fsm-shell@1.13.2/release/fsm-shell-client.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).FSMShell={})}(this,(function(e){"use strict";var t,i={Version1:{REQUIRE_CONTEXT:"V1.REQUIRE_CONTEXT",REQUIRE_AUTHENTICATION:"V1.REQUIRE_AUTHENTICATION",CLOSE:"V1.CLOSE",REQUIRE_PERMISSIONS:"V1.REQUIRE_PERMISSIONS",GET_PERMISSIONS:"V1.GET_PERMISSIONS",GET_SETTINGS:"V1.GET_SETTINGS",GET_STORAGE_ITEM:"V1.GET_STORAGE_ITEM",SET_STORAGE_ITEM:"V1.SET_STORAGE_ITEM",SET_VIEW_STATE:"V1.SET_VIEW_STATE",SET_TITLE:"V1.SET_TITLE",RESTORE_TITLE:"V1.RESTORE_TITLE",TO_APP:"V1.TO_APP",GET_FEATURE_FLAG:"V1.GET_FEATURE_FLAG",PRIVATE:{GET_ACCOUNT_SETTINGS:"V1.PRIVATE.GET_ACCOUNT_SETTINGS"},OUTLET:{ADD_PLUGIN:"V1.OUTLET.ADD_PLUGIN",REMOVE_PLUGIN:"V1.OUTLET.REMOVE_PLUGIN",REQUEST_CONTEXT:"V1.OUTLET.REQUEST_CONTEXT",LOADING_SUCCESS:"V1.OUTLET.LOADING_SUCCESS",LOADING_FAIL:"V1.OUTLET.LOADING_FAIL"},MODAL:{OPEN:"V1.MODAL.OPEN",CLOSE:"V1.MODAL.CLOSE"}},Version2:{GET_STORAGE_ITEM:"V2.GET_STORAGE_ITEM",GET_PERMISSIONS:"V2.GET_PERMISSIONS"},ERROR:"ERROR"};e.ErrorType=void 0,(t=e.ErrorType||(e.ErrorType={})).OUTLET_TIMEOUT="OUTLET_TIMEOUT",t.OUTLET_MAXIMUM_DEPTH="OUTLET_MAXIMUM_DEPTH",t.OUTLET_HTTPS_ERROR="OUTLET_HTTPS_ERROR";var n=function(e,t){void 0===t&&(t=[]);var i=t.slice();for(var r in e)"string"==typeof e[r]?i.push(e[r]):"object"==typeof e[r]&&(i=n(e[r],i));return i},r=n(i),o="1.13.2",s="2021-09-24T11:32:11.456Z",a=function(){function e(){this.messages=[]}return e.prototype.push=function(e,t){var i;i="incoming"===e.direction?"yes"===e.handled?"received and handled":"received and skipped":"sending",console.log(t+" "+i+" message: ",e),this.messages.push(e)},e.prototype.all=function(){return this.messages},e.prototype.allTable=function(){console.table(this.all())},e.prototype.filter=function(e){return this.messages.filter((function(t){if(e.type){if(Array.isArray(e.type)&&!e.type.some((function(e){return new RegExp(e).test(t.type)})))return!1;if("string"==typeof e.type&&!RegExp(e.type).test(t.type))return!1}if(e.component){if(Array.isArray(e.component)&&!e.component.some((function(e){return e===t.component})))return!1;if(e.component!==t.component)return!1}return(!e.direction||e.direction===t.direction)&&((!e.direction||"incoming"!==e.direction||void 0===e.handled||e.handled===("yes"===t.handled))&&(!(e.from&&e.from>t.timestamp)&&!(e.to&&e.to<t.timestamp)))}))},e.prototype.filterTable=function(e){console.table(this.filter(e))},e}(),u=function(){function e(e,t){if(this.winRef=e,this.debugId=t,this.debugMode=!1,this.debugId){var i=this.winRef.localStorage.getItem("cs.fsm-shell.debug");i&&i.split(",").some((function(e){return e===t}))&&(this.debugMode=!0)}}return e.prototype.traceEvent=function(e,t,i,n,o){if(this.debugMode&&r.some((function(e){return e===t}))){var s={timestamp:new Date,component:this.debugId,direction:e,type:t,handled:"incoming"===e?o?"yes":"no":"n/a",to:n.to,from:n.from,payload:i};this.logEvent(s)}},e.prototype.logEvent=function(e){var t=this.winRef;t.fsmShellMessageLogger||(t.fsmShellMessageLogger=new a),t.fsmShellMessageLogger.push(e,this.debugId)},e}();var l=function(){function t(t,n,r,o,s){var a=this;this.target=t,this.origin=n,this.winRef=r,this.outletMaximumDepth=s,this.allowedOrigins=[],this.ignoredOrigins=[],this.on=function(e,t){return a.subscribersMap.has(e)||a.subscribersMap.set(e,[]),a.subscribersMap.get(e).push(t),function(){a.removeSubscriber(e,t)}},this.onViewState=function(e,t){return a.subscribersViewStateMap.has(e)||a.subscribersViewStateMap.set(e,[]),a.subscribersViewStateMap.get(e).push(t),function(){a.removeViewStateSubscriber(e,t)}},this.off=function(e,t){a.removeSubscriber(e,t)},this.offViewState=function(e,t){a.removeViewStateSubscriber(e,t)},this.onMessage=function(t){if(t.data&&"string"==typeof t.data.type&&(t.source===window.parent||!a.ignoredOrigins||!Array.isArray(a.ignoredOrigins)||0===a.ignoredOrigins.length||-1===a.ignoredOrigins.indexOf(t.origin)))if(t.source!==window.parent&&a.allowedOrigins&&Array.isArray(a.allowedOrigins)&&0!==a.allowedOrigins.length&&-1===a.allowedOrigins.indexOf(t.origin))console.error(t.origin+" is not in the list of known origins");else{var n=t.data;if(n.type!==i.Version1.OUTLET.LOADING_SUCCESS){if(!a.isRoot){var r=t.source;if(r){var o=Array.from(a.outletsMap.keys()).find((function(e){return e.contentWindow===r}));if(o&&o.src){if(new URL(o.src).origin!==t.origin)return void a.debugger.traceEvent("blocked",n.type,n.value,{from:n.from},!1);var s=n.from||[];if(n.type===i.Version1.SET_VIEW_STATE)return void console.warn("[ShellSDk] A plugin tried to update viewState using SetViewState which is not allowed for security reason.");if(n.type===i.Version1.MODAL.OPEN&&0===s.length&&!a.allowedOrigins.some((function(e){return n.value.url.startsWith(e)})))return void console.warn("[ShellSDk] MODAL OPEN url is not in allowedList.");if(n.type===i.Version1.OUTLET.REQUEST_CONTEXT&&s.length>=a.outletMaximumDepth)r.postMessage({type:i.Version1.OUTLET.LOADING_FAIL,value:{target:n.value.target,error:e.ErrorType.OUTLET_MAXIMUM_DEPTH},to:s},a.origin);else{var u=a.outletsMap.get(o);u&&u.uuid&&(n.type===i.Version1.REQUIRE_CONTEXT&&0===s.length&&void 0!==u.name&&(n.value.targetOutletName=u.name),s=s.concat([u.uuid]),a.debugger.traceEvent("outgoing",n.type,n.value,{from:s},!0),a.target.postMessage({type:n.type,value:n.value,from:s},a.origin))}return}if(r!==a.target)return}if(n.type===i.Version1.SET_VIEW_STATE){a.outletsMap.forEach((function(e,t){t.contentWindow&&t.contentWindow.postMessage({type:n.type,value:n.value},a.origin)}));var l=a.subscribersViewStateMap.get(n.value.key);if(a.debugger.traceEvent("incoming",n.type,n.value,{},!!l),l)for(var g=0,p=l;g<p.length;g++){(0,p[g])(n.value.value)}return}if(n.type!==i.Version1.OUTLET.REQUEST_CONTEXT||!n.value.hasOwnProperty("isConfigurationMode")||n.value.hasOwnProperty("target")||n.value.hasOwnProperty("plugin")||a.outletsMap.forEach((function(e,t){t.contentWindow&&t.contentWindow.postMessage({type:n.type,value:n.value},a.origin)})),n.to&&0!==n.to.length&&n.type!==i.Version1.TO_APP)return a.debugger.traceEvent("outgoing",n.type,n.value,{to:n.to},!0),void a.outletsMap.forEach((function(e,t){n.to&&-1!==n.to.indexOf(e.uuid)&&t.contentWindow&&t.contentWindow.postMessage({type:n.type,value:n.value,to:n.to.filter((function(t){return t!==e.uuid}))},a.origin)}))}var E=a.subscribersMap.get(n.type);if(a.debugger.traceEvent("incoming",n.type,n.value,{from:n.from},!!E),E)for(var d=0,f=E;d<f.length;d++){(0,f[d])(n.value,t.origin,n.type===i.Version1.SET_VIEW_STATE?null:n.from,t)}if(!a.isRoot&&n.type===i.Version1.REQUIRE_CONTEXT){var c="string"==typeof n.value?JSON.parse(n.value):n.value,T=c.viewState;if(a.isInsideModal=!!c.isInsideShellModal,T)for(var h=0,S=Object.keys(T);h<S.length;h++){var O=S[h];if(l=a.subscribersViewStateMap.get(""+O))for(var y=0,v=l;y<v.length;y++){(0,v[y])(T[O])}}a.target.postMessage({type:i.Version1.OUTLET.LOADING_SUCCESS},a.origin)}}}},this.subscribersMap=new Map,this.subscribersViewStateMap=new Map,this.outletsMap=new Map,this.initMessageApi(),this.debugger=new u(r,o),this.isRoot=null==t,this.isInsideModal=!1}return t.init=function(e,i,n,r,o){return void 0===n&&(n=window),void 0===r&&(r=""),void 0===o&&(o=1),t._instance=new t(e,i,n,r,o),t._instance},Object.defineProperty(t,"instance",{get:function(){if(!t._instance)throw new Error("ShellSdk wasn't initialized.");return t._instance},enumerable:!0,configurable:!0}),t.isInsideShell=function(){var e=window;return e.self!==e.top},t.prototype.isInsideShellModal=function(){return this.isInsideModal},t.prototype.setAllowedOrigins=function(e){void 0===e&&(e=[]),this.allowedOrigins="*"===e?[]:e},t.prototype.addAllowedOrigin=function(e){var t;try{t=new URL(e)}catch(e){return}this.allowedOrigins.push(t.origin)},t.prototype.removeAllowedOrigin=function(e){var t;try{t=new URL(e)}catch(e){return}var i=this.allowedOrigins.findIndex((function(e){return e===t.origin}));this.allowedOrigins=this.allowedOrigins.filter((function(e,t){return t!==i}))},t.prototype.isOriginAllowed=function(e){var t;try{t=new URL(e)}catch(e){return!1}return this.allowedOrigins.some((function(e){return e===t.origin}))},t.prototype.setIgnoredOrigins=function(e){void 0===e&&(e=[]),this.ignoredOrigins=e},t.prototype.addIgnoredOrigin=function(e){var t;try{t=new URL(e)}catch(e){return}this.ignoredOrigins.push(t.origin)},t.prototype.removeIgnoredOrigin=function(e){var t;try{t=new URL(e)}catch(e){return}var i=this.ignoredOrigins.findIndex((function(e){return e===t.origin}));this.ignoredOrigins=this.ignoredOrigins.filter((function(e,t){return t!==i}))},t.prototype.registerOutlet=function(e,t){this.outletsMap.set(e,{uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),name:t})},t.prototype.unregisterOutlet=function(e){this.outletsMap.delete(e)},t.prototype.getTarget=function(){return this.target},t.prototype.setTarget=function(e,t){(this.target!==e||this.origin!==t)&&(this.target=e,this.origin=t)},t.prototype.emit=function(e,t,i){if(!this.postMessageHandler)throw new Error("ShellSdk wasn't initialized, message handler not set.");this.postMessageHandler(e,t,this.isRoot?i:void 0)},t.prototype.setViewState=function(e,t){if(!this.postMessageHandler)throw new Error("ShellSdk wasn't initialized, message handler not set.");this.postMessageHandler(i.Version1.SET_VIEW_STATE,{key:e,value:t})},t.prototype.removeSubscriber=function(e,t){var i=this.subscribersMap.get(e);i&&this.subscribersMap.set(e,i.filter((function(e){return e!==t})))},t.prototype.removeViewStateSubscriber=function(e,t){var i=this.subscribersViewStateMap.get(e);i&&this.subscribersViewStateMap.set(e,i.filter((function(e){return e!==t})))},t.prototype.initMessageApi=function(){var e=this;this.postMessageHandler=function(t,i,n){if(!e.target)throw new Error("ShellSdk wasn't initialized, target is missing.");if(!e.origin)throw new Error("ShellSdk wasn't initialized, origin is missing.");e.debugger.traceEvent("outgoing",t,i,{to:n},!0),e.target.postMessage({type:t,value:i,to:n},e.origin)},this.winRef.addEventListener("message",this.onMessage)},t.VERSION=o,t.BUILD_TS=s,t}();e.SHELL_EVENTS=i,e.ShellSdk=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=/sm/2bfcd4ddf2f152a6fb07dc473db84884dcb5281f054cdf7b02f886f6920fbab8.map
